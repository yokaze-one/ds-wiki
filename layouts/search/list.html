{{ define "title" }}
    検索結果 | {{ .Site.Title }}
{{ end }}

{{ define "main" }}
<article class="wiki-article">
    <h1>検索結果</h1>
    
    <div id="search-result-container">
        <p>検索結果を読み込み中です...</p>
    </div>
    
</article>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 1. URLから検索クエリを取得
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('q');
    const container = document.getElementById('search-result-container');
    
    if (!query) {
        container.innerHTML = '<p>検索キーワードがありません。</p>';
        return;
    }

    container.innerHTML = `<p>「<strong>${query}</strong>」の検索結果:</p><hr><ul id="dynamic-search-results"></ul>`;
    const resultsList = document.getElementById('dynamic-search-results');
    
    let fuse;

    // 2. 検索インデックス (index.json) を読み込む
    fetch('/index.json')
        .then(response => response.json())
        .then(data => {
            const options = {
                keys: ['title', 'content'], 
                includeScore: true,
                threshold: 0.3 // 検索の厳しさ
            };
            fuse = new Fuse(data, options);
            
            // 3. 検索の実行
            const results = fuse.search(query); 
            
            // 4. 結果の表示
            if (results.length > 0) {
                results.forEach(result => {
                    const item = document.createElement('li');
                    const link = document.createElement('a');
                    link.href = result.item.permalink;
                    link.textContent = result.item.title;
                    item.appendChild(link);
                    resultsList.appendChild(item);
                });
            } else {
                resultsList.innerHTML = '<li>一致する検索結果が見つかりませんでした。</li>';
            }
        })
        .catch(error => {
            container.innerHTML = `<p style="color: red;">検索データの読み込みに失敗しました。</p>`;
            console.error('Error loading search index:', error);
        });
});
</script>
{{ end }}